<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ± å­¦ä¹ ä½¿æˆ‘å¼ºå¤§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1f0a, #1b2e1b, #2d4a2d);
            color: #e8f5e8;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(76, 175, 80, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(129, 199, 132, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(165, 214, 167, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* ç¡®ä¿ç•Œé¢å…ƒç´ æ­£ç¡®å±‚å  */
        #loginScreen, #registerScreen, #mainScreen {
            position: relative;
            z-index: 10;
            width: 100%;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1));
            border-radius: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, #81c784, #4caf50, #66bb6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 25px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #4caf50, transparent);
        }

        .login-form, .register-form {
            max-width: 420px;
            margin: 50px auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #a5d6a7;
            font-size: 0.95em;
        }

        input[type="text"], input[type="password"], textarea, select, input[type="date"], input[type="number"] {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.95);
            color: #2e7d32;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #81c784, #a5d6a7);
            color: #2e7d32;
            box-shadow: 0 4px 15px rgba(129, 199, 132, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffb74d, #ffa726);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef5350, #f44336);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 83, 80, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .timer-display {
            font-size: 3.5em;
            font-weight: 800;
            text-align: center;
            margin: 30px 0;
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1));
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            color: #81c784;
        }

        .task-list {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .task-item {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.12), rgba(129, 199, 132, 0.08));
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #4caf50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .task-item.completed {
            border-left-color: #66bb6a;
            background: linear-gradient(135deg, rgba(102, 187, 106, 0.15), rgba(129, 199, 132, 0.1));
            opacity: 0.9;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: #a5d6a7;
            font-size: 1.1em;
        }

        .task-description {
            font-size: 0.95em;
            opacity: 0.85;
            color: #c8e6c9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-item {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1));
            border-radius: 18px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 10px;
            color: #81c784;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hidden {
            display: none !important;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            padding: 8px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            background: transparent;
            border: none;
            color: #a5d6a7;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab.active {
            color: #e8f5e8;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(129, 199, 132, 0.15));
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .tab:hover {
            color: #e8f5e8;
            transform: translateY(-2px);
        }

        .pomodoro-timer {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(129, 199, 132, 0.1));
            border-radius: 25px;
            margin: 30px 0;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .mode-switcher {
            display: flex;
            margin-bottom: 25px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            padding: 5px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #a5d6a7;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95em;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(129, 199, 132, 0.2));
            color: #e8f5e8;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
        }

        .pomodoro-mode {
            font-size: 1.6em;
            margin-bottom: 25px;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .mode-work {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
        }

        .mode-break {
            background: linear-gradient(135deg, #81c784, #a5d6a7);
            color: #2e7d32;
        }

        .mode-longbreak {
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            color: white;
        }

        .pomodoro-display {
            font-size: 6.5em;
            font-weight: 800;
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5);
            color: #81c784;
            margin: 0;
        }

        .pomodoro-progress {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .pomodoro-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .pomodoro-dot.completed {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            border-color: #66bb6a;
        }

        .priority-high {
            border-left-color: #ef5350 !important;
        }

        .priority-medium {
            border-left-color: #ffb74d !important;
        }

        .priority-low {
            border-left-color: #66bb6a !important;
        }

        .category-tags {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .category-tag {
            background: rgba(76, 175, 80, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #a5d6a7;
        }

        .category-tag:hover {
            background: rgba(76, 175, 80, 0.3);
            transform: translateY(-2px);
        }

        .category-tag.selected {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .mini-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .mini-stat {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.08));
            border-radius: 15px;
            border: 1px solid rgba(76, 175, 80, 0.2);
            transition: all 0.3s ease;
        }

        .mini-stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .mini-stat-number {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 8px;
            color: #81c784;
        }

        .mini-stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            color: #a5d6a7;
        }

        .settings-section {
            margin: 25px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.08));
            border-radius: 18px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px 0;
            border-bottom: 1px solid rgba(76, 175, 80, 0.2);
        }

        .toggle-switch {
            position: relative;
            width: 65px;
            height: 32px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            border-color: #66bb6a;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(33px);
        }

        .focus-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(46, 125, 50, 0.1));
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .focus-timer {
            font-size: 8.5em;
            font-weight: 800;
            color: #81c784;
            text-shadow: 0 0 30px rgba(129, 199, 132, 0.8);
            margin-bottom: 40px;
            font-family: 'SF Mono', monospace;
        }

        .focus-task {
            font-size: 2.2em;
            color: #a5d6a7;
            text-align: center;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .tab-content {
            display: block;
        }

        .tab-content.hidden {
            display: none;
        }

        h3 {
            color: #a5d6a7;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div id="loginScreen">
            <div class="header">
                <h1>ğŸŒ± å­¦ä¹ ä½¿æˆ‘å¼ºå¤§</h1>
                <p>ä¸“æ³¨å­¦ä¹ ï¼Œæˆå°±æœªæ¥</p>
            </div>
            <div class="card login-form">
                <h3>ğŸƒ ç”¨æˆ·ç™»å½•</h3>
                <div class="form-group">
                    <label for="loginUsername">ç”¨æˆ·å</label>
                    <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="admin">
                </div>
                <div class="form-group">
                    <label for="loginPassword">å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " value="admin">
                </div>
                <button onclick="login()" class="btn-primary">ç™»å½•</button>
                <button onclick="showRegister()" class="btn-secondary">æ³¨å†Œæ–°è´¦å·</button>
            </div>
        </div>

        <!-- æ³¨å†Œç•Œé¢ -->
        <div id="registerScreen" class="hidden">
            <div class="header">
                <h1>ğŸŒ± æ³¨å†Œæ–°è´¦å·</h1>
            </div>
            <div class="card register-form">
                <h3>ğŸŒ¿ åˆ›å»ºè´¦å·</h3>
                <div class="form-group">
                    <label for="regUsername">ç”¨æˆ·å</label>
                    <input type="text" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label for="regPassword">å¯†ç </label>
                    <input type="password" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">ç¡®è®¤å¯†ç </label>
                    <input type="password" id="regConfirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                </div>
                <button onclick="register()" class="btn-primary">æ³¨å†Œ</button>
                <button onclick="showLogin()" class="btn-secondary">è¿”å›ç™»å½•</button>
            </div>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div id="mainScreen" class="hidden">
            <div class="header">
                <h1>ğŸŒ¿ å­¦ä¹ ä½¿æˆ‘å¼ºå¤§</h1>
                <div class="user-info">
                    <span>æ¬¢è¿, <span id="currentUser">ç”¨æˆ·</span></span>
                    <button onclick="logout()" class="btn-warning">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <!-- å¯¼èˆªæ ‡ç­¾ -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('dashboard', event)">ğŸ“Š ä»ªè¡¨ç›˜</button>
                <button class="tab" onclick="showTab('pomodoro', event)">ğŸ… ç•ªèŒ„é’Ÿ</button>
                <button class="tab" onclick="showTab('tasks', event)">ğŸ“ ä»»åŠ¡ç®¡ç†</button>
                <button class="tab" onclick="showTab('dailyTasks', event)">ğŸ“… æ¯æ—¥ä»»åŠ¡</button>
                <button class="tab" onclick="showTab('settings', event)">âš™ï¸ è®¾ç½®</button>
            </div>

            <!-- ä»ªè¡¨ç›˜ -->
            <div id="dashboardTab" class="tab-content">
                <div class="timer-display">
                    <div id="todayTime">00:00:00</div>
                    <div style="font-size: 0.3em; margin-top: 10px;">ä»Šæ—¥å­¦ä¹ æ—¶é—´</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="todayPomodoros">0</div>
                        <div>ä»Šæ—¥ç•ªèŒ„é’Ÿ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="todayTasks">0</div>
                        <div>ä»Šæ—¥å®Œæˆä»»åŠ¡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="currentStreak">0</div>
                        <div>å½“å‰è¿ç»­å¤©æ•°</div>
                    </div>
                </div>

                <div class="mini-stats">
                    <div class="mini-stat">
                        <div class="mini-stat-number" id="totalTime">00:00:00</div>
                        <div class="mini-stat-label">æ€»å­¦ä¹ æ—¶é—´</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-stat-number" id="totalTasks">0</div>
                        <div class="mini-stat-label">æ€»å®Œæˆä»»åŠ¡</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-stat-number" id="totalPomodoros">0</div>
                        <div class="mini-stat-label">æ€»ç•ªèŒ„é’Ÿ</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-stat-number" id="bestStreak">0</div>
                        <div class="mini-stat-label">æœ€ä½³è¿ç»­</div>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ“‹ ä»Šæ—¥ä»»åŠ¡</h3>
                    <div id="todayTaskList" class="task-list">
                        <div class="task-item">
                            <div class="task-content">
                                <div class="task-title">æš‚æ— ä»»åŠ¡</div>
                                <div class="task-description">è¯·æ·»åŠ ä»Šæ—¥çš„å­¦ä¹ ä»»åŠ¡</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ“… æ¯æ—¥ä»»åŠ¡æ‰“å¡</h3>
                    <div id="todayDailyTasks" class="mini-stats">
                        <div class="mini-stat">
                            <div class="mini-stat-number">æš‚æ— æ¯æ—¥ä»»åŠ¡</div>
                            <div class="mini-stat-label">è¯·æ·»åŠ éœ€è¦æ¯å¤©å®Œæˆçš„ä»»åŠ¡</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç•ªèŒ„é’Ÿ -->
            <div id="pomodoroTab" class="tab-content hidden">
                <div class="card pomodoro-timer">
                    <div class="mode-switcher">
                        <button class="mode-btn active" onclick="setPomodoroMode('pomodoro')">ğŸ… å·¥ä½œ</button>
                        <button class="mode-btn" onclick="setPomodoroMode('shortBreak')">â˜• çŸ­ä¼‘æ¯</button>
                        <button class="mode-btn" onclick="setPomodoroMode('longBreak')">ğŸ›‹ï¸ é•¿ä¼‘æ¯</button>
                        <button class="mode-btn" onclick="setPomodoroMode('free')">ğŸ¯ è‡ªç”±æ¨¡å¼</button>
                    </div>

                    <div class="pomodoro-mode mode-work" id="pomodoroModeDisplay">ğŸ… å·¥ä½œæ—¶é—´</div>
                    
                    <div class="pomodoro-display" id="pomodoroDisplay">25:00</div>
                    
                    <div class="pomodoro-progress" id="pomodoroProgress">
                        <div class="pomodoro-dot"></div>
                        <div class="pomodoro-dot"></div>
                        <div class="pomodoro-dot"></div>
                        <div class="pomodoro-dot"></div>
                    </div>

                    <div style="margin: 30px 0;">
                        <button id="pomodoroStartBtn" onclick="startPomodoro()" class="btn-primary">å¼€å§‹</button>
                        <button id="pomodoroPauseBtn" onclick="pausePomodoro()" class="btn-warning hidden">æš‚åœ</button>
                        <button id="pomodoroResetBtn" onclick="resetPomodoro()" class="btn-secondary">é‡ç½®</button>
                        <button onclick="toggleFocusMode()" class="btn-secondary">ä¸“æ³¨æ¨¡å¼</button>
                    </div>

                    <div class="form-group">
                        <label for="currentTask">å½“å‰ä»»åŠ¡</label>
                        <input type="text" id="currentTask" placeholder="è¾“å…¥å½“å‰ä¸“æ³¨çš„ä»»åŠ¡...">
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡ç®¡ç† -->
            <div id="tasksTab" class="tab-content hidden">
                <div class="card">
                    <h3>ğŸ“ æ·»åŠ æ–°ä»»åŠ¡</h3>
                    <div class="form-group">
                        <label for="taskTitle">ä»»åŠ¡æ ‡é¢˜</label>
                        <input type="text" id="taskTitle" placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜...">
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">ä»»åŠ¡æè¿°</label>
                        <textarea id="taskDescription" placeholder="è¾“å…¥ä»»åŠ¡æè¿°..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">ä¼˜å…ˆçº§</label>
                        <select id="taskPriority">
                            <option value="low">ä½</option>
                            <option value="medium" selected>ä¸­</option>
                            <option value="high">é«˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskCategory">åˆ†ç±»</label>
                        <input type="text" id="taskCategory" placeholder="è¾“å…¥ä»»åŠ¡åˆ†ç±»...">
                    </div>
                    <div class="form-group">
                        <label for="taskDueDate">æˆªæ­¢æ—¥æœŸ</label>
                        <input type="date" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label for="taskEstimatedTime">é¢„è®¡æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                        <input type="number" id="taskEstimatedTime" placeholder="é¢„è®¡å®Œæˆæ—¶é—´..." min="1">
                    </div>
                    <button onclick="addTask()" class="btn-primary">æ·»åŠ ä»»åŠ¡</button>
                </div>

                <div class="card">
                    <h3>ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h3>
                    <div class="category-tags" id="categoryFilter">
                        <div class="category-tag selected" onclick="filterTasks('all')">å…¨éƒ¨</div>
                    </div>
                    <div id="taskList" class="task-list">
                        <div class="task-item">
                            <div class="task-content">
                                <div class="task-title">æš‚æ— ä»»åŠ¡</div>
                                <div class="task-description">è¯·æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªä»»åŠ¡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¯æ—¥ä»»åŠ¡ -->
            <div id="dailyTasksTab" class="tab-content hidden">
                <div class="card">
                    <h3>ğŸ“… æ·»åŠ æ¯æ—¥ä»»åŠ¡</h3>
                    <div class="form-group">
                        <label for="dailyTaskTitle">ä»»åŠ¡æ ‡é¢˜</label>
                        <input type="text" id="dailyTaskTitle" placeholder="è¾“å…¥æ¯æ—¥ä»»åŠ¡æ ‡é¢˜...">
                    </div>
                    <div class="form-group">
                        <label for="dailyTaskDescription">ä»»åŠ¡æè¿°</label>
                        <textarea id="dailyTaskDescription" placeholder="è¾“å…¥ä»»åŠ¡æè¿°..."></textarea>
                    </div>
                    <button onclick="addDailyTask()" class="btn-primary">æ·»åŠ æ¯æ—¥ä»»åŠ¡</button>
                </div>

                <div class="card">
                    <h3>ğŸ“‹ æ¯æ—¥ä»»åŠ¡åˆ—è¡¨</h3>
                    <div id="dailyTaskList" class="task-list">
                        <div class="task-item">
                            <div class="task-content">
                                <div class="task-title">æš‚æ— æ¯æ—¥ä»»åŠ¡</div>
                                <div class="task-description">è¯·æ·»åŠ éœ€è¦æ¯å¤©å®Œæˆçš„ä»»åŠ¡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½® -->
            <div id="settingsTab" class="tab-content hidden">
                <div class="card">
                    <h3>âš™ï¸ ç•ªèŒ„é’Ÿè®¾ç½®</h3>
                    <div class="settings-section">
                        <div class="settings-row">
                            <label>å·¥ä½œæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" id="workDuration" value="25" min="1" max="60" style="width: 100px;">
                        </div>
                        <div class="settings-row">
                            <label>çŸ­ä¼‘æ¯æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" id="shortBreakDuration" value="5" min="1" max="30" style="width: 100px;">
                        </div>
                        <div class="settings-row">
                            <label>é•¿ä¼‘æ¯æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" id="longBreakDuration" value="15" min="1" max="60" style="width: 100px;">
                        </div>
                        <div class="settings-row">
                            <label>é•¿ä¼‘æ¯é—´éš”ï¼ˆç•ªèŒ„é’Ÿæ•°ï¼‰</label>
                            <input type="number" id="longBreakInterval" value="4" min="2" max="10" style="width: 100px;">
                        </div>
                        <button onclick="saveSettings()" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ”” é€šçŸ¥è®¾ç½®</h3>
                    <div class="settings-section">
                        <div class="settings-row">
                            <label>å¯ç”¨å£°éŸ³æé†’</label>
                            <div class="toggle-switch" id="soundToggle" onclick="toggleSetting('sound')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="settings-row">
                            <label>å¯ç”¨æ¡Œé¢é€šçŸ¥</label>
                            <div class="toggle-switch" id="notificationToggle" onclick="toggleSetting('notification')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ’¾ æ•°æ®ç®¡ç†</h3>
                    <div class="settings-section">
                        <button onclick="exportData()" class="btn-primary">å¯¼å‡ºæ•°æ®</button>
                        <button onclick="importData()" class="btn-secondary">å¯¼å…¥æ•°æ®</button>
                        <button onclick="clearAllData()" class="btn-danger">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸“æ³¨æ¨¡å¼è¦†ç›–å±‚ -->
        <div id="focusMode" class="focus-mode hidden">
            <div class="focus-task" id="focusTaskDisplay">ä¸“æ³¨å­¦ä¹ </div>
            <div class="focus-timer" id="focusTimer">25:00</div>
            <div>
                <button onclick="toggleFocusMode()" class="btn-secondary">é€€å‡ºä¸“æ³¨æ¨¡å¼</button>
                <button id="focusPauseBtn" onclick="pausePomodoro()" class="btn-warning">æš‚åœ</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = null;
        let pomodoroTimer = null;
        let pomodoroTimeLeft = 25 * 60;
        let pomodoroMode = 'pomodoro';
        let pomodoroCount = 0;
        let isRunning = false;
        let isPaused = false;
        let focusModeActive = false;
        let dailyStartTime = null;
        let totalTimeToday = 0;
        let sessionStartTime = null;

        // è®¾ç½®
        let settings = {
            workDuration: 25,
            shortBreakDuration: 5,
            longBreakDuration: 15,
            longBreakInterval: 4,
            sound: true,
            notification: true
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            initDefaultUser();
            checkLogin();
            updateDashboard();
            requestNotificationPermission();
            
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('dailyStartDate');
            if (savedDate !== today) {
                localStorage.setItem('dailyStartDate', today);
                localStorage.setItem('dailyStartTime', Date.now().toString());
                dailyStartTime = Date.now();
            } else {
                dailyStartTime = parseInt(localStorage.getItem('dailyStartTime')) || Date.now();
            }
        });

        // ç”¨æˆ·ç®¡ç†
        function initDefaultUser() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users['admin']) {
                users['admin'] = {
                    username: 'admin',
                    password: 'admin',
                    createdAt: new Date().toISOString(),
                    stats: {
                        totalTime: 0,
                        totalTasks: 0,
                        totalPomodoros: 0,
                        currentStreak: 0,
                        bestStreak: 0,
                        lastActiveDate: null
                    },
                    tasks: [],
                    dailyTasks: [],
                    completedTasks: [],
                    dailyStats: {}
                };
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function checkLogin() {
            const loggedInUser = localStorage.getItem('currentUser');
            if (loggedInUser) {
                currentUser = loggedInUser;
                showMainScreen();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showMainScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            document.getElementById('currentUser').textContent = currentUser;
            updateDashboard();
            loadTasks();
            loadDailyTasks();
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showNotification('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const user = users[username];

            if (user && user.password === password) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                showMainScreen();
                showNotification('ç™»å½•æˆåŠŸï¼', 'success');
            } else {
                showNotification('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
            }
        }

        function register() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (!username || !password || !confirmPassword) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }

            if (username.length < 3) {
                showNotification('ç”¨æˆ·åè‡³å°‘éœ€è¦3ä¸ªå­—ç¬¦', 'error');
                return;
            }

            if (password.length < 4) {
                showNotification('å¯†ç è‡³å°‘éœ€è¦4ä¸ªå­—ç¬¦', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (users[username]) {
                showNotification('ç”¨æˆ·åå·²å­˜åœ¨', 'error');
                return;
            }

            users[username] = {
                username: username,
                password: password,
                createdAt: new Date().toISOString(),
                stats: {
                    totalTime: 0,
                    totalTasks: 0,
                    totalPomodoros: 0,
                    currentStreak: 0,
                    bestStreak: 0,
                    lastActiveDate: null
                },
                tasks: [],
                dailyTasks: [],
                completedTasks: [],
                dailyStats: {}
            };

            localStorage.setItem('users', JSON.stringify(users));
            showNotification('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•', 'success');
            showLogin();
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            resetPomodoro();
            showLogin();
            showNotification('å·²é€€å‡ºç™»å½•', 'info');
        }

        // æ ‡ç­¾é¡µç®¡ç†
        function showTab(tabName, event) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.add('hidden'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'settings') {
                loadSettingsUI();
            }
        }

        // ç•ªèŒ„é’ŸåŠŸèƒ½
        function setPomodoroMode(mode) {
            if (isRunning) {
                showNotification('è¯·å…ˆåœæ­¢å½“å‰è®¡æ—¶å™¨', 'warning');
                return;
            }

            pomodoroMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const modeDisplay = document.getElementById('pomodoroModeDisplay');
            
            switch(mode) {
                case 'pomodoro':
                    pomodoroTimeLeft = settings.workDuration * 60;
                    modeDisplay.textContent = 'ğŸ… å·¥ä½œæ—¶é—´';
                    modeDisplay.className = 'pomodoro-mode mode-work';
                    break;
                case 'shortBreak':
                    pomodoroTimeLeft = settings.shortBreakDuration * 60;
                    modeDisplay.textContent = 'â˜• çŸ­ä¼‘æ¯';
                    modeDisplay.className = 'pomodoro-mode mode-break';
                    break;
                case 'longBreak':
                    pomodoroTimeLeft = settings.longBreakDuration * 60;
                    modeDisplay.textContent = 'ğŸ›‹ï¸ é•¿ä¼‘æ¯';
                    modeDisplay.className = 'pomodoro-mode mode-longbreak';
                    break;
                case 'free':
                    pomodoroTimeLeft = 0;
                    modeDisplay.textContent = 'ğŸ¯ è‡ªç”±æ¨¡å¼';
                    modeDisplay.className = 'pomodoro-mode mode-work';
                    break;
            }
            
            updatePomodoroDisplay();
        }

        function startPomodoro() {
            if (isPaused) {
                isPaused = false;
                isRunning = true;
                sessionStartTime = Date.now();
            } else {
                isRunning = true;
                sessionStartTime = Date.now();
                
                if (pomodoroMode === 'free') {
                    pomodoroTimeLeft = 0;
                }
            }

            document.getElementById('pomodoroStartBtn').classList.add('hidden');
            document.getElementById('pomodoroPauseBtn').classList.remove('hidden');

            pomodoroTimer = setInterval(() => {
                if (pomodoroMode === 'free') {
                    pomodoroTimeLeft++;
                } else {
                    pomodoroTimeLeft--;
                    
                    if (pomodoroTimeLeft <= 0) {
                        pomodoroComplete();
                        return;
                    }
                }
                
                updatePomodoroDisplay();
                updateFocusDisplay();
            }, 1000);

            showNotification('è®¡æ—¶å™¨å·²å¼€å§‹', 'success');
        }

        function pausePomodoro() {
            if (!isRunning) return;

            clearInterval(pomodoroTimer);
            isRunning = false;
            isPaused = true;

            document.getElementById('pomodoroStartBtn').classList.remove('hidden');
            document.getElementById('pomodoroPauseBtn').classList.add('hidden');

            if (sessionStartTime) {
                const sessionTime = Math.floor((Date.now() - sessionStartTime) / 1000);
                addStudyTime(sessionTime);
                sessionStartTime = null;
            }

            showNotification('è®¡æ—¶å™¨å·²æš‚åœ', 'info');
        }

        function resetPomodoro() {
            clearInterval(pomodoroTimer);
            isRunning = false;
            isPaused = false;

            if (sessionStartTime) {
                const sessionTime = Math.floor((Date.now() - sessionStartTime) / 1000);
                addStudyTime(sessionTime);
                sessionStartTime = null;
            }

            document.getElementById('pomodoroStartBtn').classList.remove('hidden');
            document.getElementById('pomodoroPauseBtn').classList.add('hidden');

            switch(pomodoroMode) {
                case 'pomodoro':
                    pomodoroTimeLeft = settings.workDuration * 60;
                    break;
                case 'shortBreak':
                    pomodoroTimeLeft = settings.shortBreakDuration * 60;
                    break;
                case 'longBreak':
                    pomodoroTimeLeft = settings.longBreakDuration * 60;
                    break;
                case 'free':
                    pomodoroTimeLeft = 0;
                    break;
            }

            updatePomodoroDisplay();
            updateFocusDisplay();
            showNotification('è®¡æ—¶å™¨å·²é‡ç½®', 'info');
        }

        function pomodoroComplete() {
            clearInterval(pomodoroTimer);
            isRunning = false;
            isPaused = false;

            if (pomodoroMode === 'pomodoro') {
                pomodoroCount++;
                updatePomodoroProgress();
                
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                if (users[currentUser]) {
                    users[currentUser].stats.totalPomodoros++;
                    
                    const today = new Date().toDateString();
                    if (!users[currentUser].dailyStats[today]) {
                        users[currentUser].dailyStats[today] = { pomodoros: 0, tasks: 0, time: 0 };
                    }
                    users[currentUser].dailyStats[today].pomodoros++;
                    
                    localStorage.setItem('users', JSON.stringify(users));
                }
            }

            if (sessionStartTime) {
                const sessionTime = Math.floor((Date.now() - sessionStartTime) / 1000);
                addStudyTime(sessionTime);
                sessionStartTime = null;
            }

            document.getElementById('pomodoroStartBtn').classList.remove('hidden');
            document.getElementById('pomodoroPauseBtn').classList.add('hidden');

            if (settings.sound) {
                playNotificationSound();
            }

            if (settings.notification) {
                showDesktopNotification('ç•ªèŒ„é’Ÿå®Œæˆï¼', `${pomodoroMode === 'pomodoro' ? 'å·¥ä½œ' : 'ä¼‘æ¯'}æ—¶é—´ç»“æŸ`);
            }

            showNotification(`${pomodoroMode === 'pomodoro' ? 'å·¥ä½œ' : 'ä¼‘æ¯'}æ—¶é—´ç»“æŸï¼`, 'success');

            if (pomodoroMode === 'pomodoro') {
                if (pomodoroCount % settings.longBreakInterval === 0) {
                    setPomodoroMode('longBreak');
                } else {
                    setPomodoroMode('shortBreak');
                }
            } else {
                setPomodoroMode('pomodoro');
            }

            updateDashboard();
        }

        function updatePomodoroDisplay() {
            const display = document.getElementById('pomodoroDisplay');
            const focusDisplay = document.getElementById('focusTimer');
            
            if (pomodoroMode === 'free') {
                const hours = Math.floor(pomodoroTimeLeft / 3600);
                const minutes = Math.floor((pomodoroTimeLeft % 3600) / 60);
                const seconds = pomodoroTimeLeft % 60;
                const timeStr = hours > 0 ? 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}` :
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                display.textContent = timeStr;
                focusDisplay.textContent = timeStr;
            } else {
                const minutes = Math.floor(pomodoroTimeLeft / 60);
                const seconds = pomodoroTimeLeft % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                display.textContent = timeStr;
                focusDisplay.textContent = timeStr;
            }
        }

        function updatePomodoroProgress() {
            const dots = document.querySelectorAll('.pomodoro-dot');
            const completedCount = pomodoroCount % settings.longBreakInterval;
            
            dots.forEach((dot, index) => {
                if (index < completedCount) {
                    dot.classList.add('completed');
                } else {
                    dot.classList.remove('completed');
                }
            });
        }

        // ä¸“æ³¨æ¨¡å¼
        function toggleFocusMode() {
            focusModeActive = !focusModeActive;
            const focusMode = document.getElementById('focusMode');
            
            if (focusModeActive) {
                focusMode.classList.remove('hidden');
                updateFocusDisplay();
            } else {
                focusMode.classList.add('hidden');
            }
        }

        function updateFocusDisplay() {
            const taskDisplay = document.getElementById('focusTaskDisplay');
            const currentTask = document.getElementById('currentTask').value || 'ä¸“æ³¨å­¦ä¹ ';
            taskDisplay.textContent = currentTask;
        }

        // ä»»åŠ¡ç®¡ç†
        function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const priority = document.getElementById('taskPriority').value;
            const category = document.getElementById('taskCategory').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            const estimatedTime = document.getElementById('taskEstimatedTime').value;

            if (!title) {
                showNotification('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜', 'error');
                return;
            }

            const task = {
                id: Date.now(),
                title,
                description,
                priority,
                category: category || 'æœªåˆ†ç±»',
                dueDate,
                estimatedTime: estimatedTime ? parseInt(estimatedTime) : null,
                completed: false,
                createdAt: new Date().toISOString(),
                completedAt: null
            };

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[currentUser]) {
                users[currentUser].tasks.push(task);
                localStorage.setItem('users', JSON.stringify(users));
            }

            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskCategory').value = '';
            document.getElementById('taskDueDate').value = '';
            document.getElementById('taskEstimatedTime').value = '';

            loadTasks();
            updateDashboard();
            showNotification('ä»»åŠ¡æ·»åŠ æˆåŠŸ', 'success');
        }

        function loadTasks() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userTasks = users[currentUser]?.tasks || [];
            
            const taskList = document.getElementById('taskList');
            const categoryFilter = document.getElementById('categoryFilter');
            
            const categories = ['å…¨éƒ¨', ...new Set(userTasks.map(task => task.category))];
            categoryFilter.innerHTML = categories.map(cat => 
                `<div class="category-tag ${cat === 'å…¨éƒ¨' ? 'selected' : ''}" onclick="filterTasks('${cat === 'å…¨éƒ¨' ? 'all' : cat}')">${cat}</div>`
            ).join('');

            if (userTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="task-item">
                        <div class="task-content">
                            <div class="task-title">æš‚æ— ä»»åŠ¡</div>
                            <div class="task-description">è¯·æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªä»»åŠ¡</div>
                        </div>
                    </div>
                `;
                return;
            }

            const sortedTasks = userTasks.sort((a, b) => {
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            taskList.innerHTML = sortedTasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''} priority-${task.priority}">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                            <span>åˆ†ç±»: ${task.category}</span>
                            ${task.dueDate ? ` | æˆªæ­¢: ${task.dueDate}` : ''}
                            ${task.estimatedTime ? ` | é¢„è®¡: ${task.estimatedTime}åˆ†é’Ÿ` : ''}
                        </div>
                    </div>
                    <div>
                        <button onclick="toggleTask(${task.id})" class="btn-${task.completed ? 'secondary' : 'primary'}">
                            ${task.completed ? 'å–æ¶ˆå®Œæˆ' : 'å®Œæˆ'}
                        </button>
                        <button onclick="deleteTask(${task.id})" class="btn-danger">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(taskId) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[currentUser]) return;

            const task = users[currentUser].tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.completedAt = task.completed ? new Date().toISOString() : null;

                if (task.completed) {
                    users[currentUser].stats.totalTasks++;
                    
                    const today = new Date().toDateString();
                    if (!users[currentUser].dailyStats[today]) {
                        users[currentUser].dailyStats[today] = { pomodoros: 0, tasks: 0, time: 0 };
                    }
                    users[currentUser].dailyStats[today].tasks++;
                }

                localStorage.setItem('users', JSON.stringify(users));
                loadTasks();
                updateDashboard();
                showNotification(task.completed ? 'ä»»åŠ¡å·²å®Œæˆï¼' : 'ä»»åŠ¡å·²å–æ¶ˆå®Œæˆ', 'success');
            }
        }

        function deleteTask(taskId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[currentUser]) return;

            users[currentUser].tasks = users[currentUser].tasks.filter(t => t.id !== taskId);
            localStorage.setItem('users', JSON.stringify(users));
            loadTasks();
            updateDashboard();
            showNotification('ä»»åŠ¡å·²åˆ é™¤', 'info');
        }

        function filterTasks(category) {
            document.querySelectorAll('.category-tag').forEach(tag => tag.classList.remove('selected'));
            event.target.classList.add('selected');

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userTasks = users[currentUser]?.tasks || [];
            
            const filteredTasks = category === 'all' ? userTasks : userTasks.filter(task => task.category === category);
            
            const taskList = document.getElementById('taskList');
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="task-item">
                        <div class="task-content">
                            <div class="task-title">æš‚æ— ä»»åŠ¡</div>
                            <div class="task-description">è¯¥åˆ†ç±»ä¸‹æš‚æ— ä»»åŠ¡</div>
                        </div>
                    </div>
                `;
                return;
            }

            const sortedTasks = filteredTasks.sort((a, b) => {
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            taskList.innerHTML = sortedTasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''} priority-${task.priority}">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                            <span>åˆ†ç±»: ${task.category}</span>
                            ${task.dueDate ? ` | æˆªæ­¢: ${task.dueDate}` : ''}
                            ${task.estimatedTime ? ` | é¢„è®¡: ${task.estimatedTime}åˆ†é’Ÿ` : ''}
                        </div>
                    </div>
                    <div>
                        <button onclick="toggleTask(${task.id})" class="btn-${task.completed ? 'secondary' : 'primary'}">
                            ${task.completed ? 'å–æ¶ˆå®Œæˆ' : 'å®Œæˆ'}
                        </button>
                        <button onclick="deleteTask(${task.id})" class="btn-danger">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // æ¯æ—¥ä»»åŠ¡ç®¡ç†
        function addDailyTask() {
            const title = document.getElementById('dailyTaskTitle').value.trim();
            const description = document.getElementById('dailyTaskDescription').value.trim();

            if (!title) {
                showNotification('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜', 'error');
                return;
            }

            const dailyTask = {
                id: Date.now(),
                title,
                description,
                createdAt: new Date().toISOString()
            };

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[currentUser]) {
                users[currentUser].dailyTasks.push(dailyTask);
                localStorage.setItem('users', JSON.stringify(users));
            }

            document.getElementById('dailyTaskTitle').value = '';
            document.getElementById('dailyTaskDescription').value = '';

            loadDailyTasks();
            updateDashboard();
            showNotification('æ¯æ—¥ä»»åŠ¡æ·»åŠ æˆåŠŸ', 'success');
        }

        function loadDailyTasks() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userDailyTasks = users[currentUser]?.dailyTasks || [];
            
            const dailyTaskList = document.getElementById('dailyTaskList');
            const todayDailyTasks = document.getElementById('todayDailyTasks');

            if (userDailyTasks.length === 0) {
                dailyTaskList.innerHTML = `
                    <div class="task-item">
                        <div class="task-content">
                            <div class="task-title">æš‚æ— æ¯æ—¥ä»»åŠ¡</div>
                            <div class="task-description">è¯·æ·»åŠ éœ€è¦æ¯å¤©å®Œæˆçš„ä»»åŠ¡</div>
                        </div>
                    </div>
                `;
                todayDailyTasks.innerHTML = `
                    <div class="mini-stat">
                        <div class="mini-stat-number">æš‚æ— æ¯æ—¥ä»»åŠ¡</div>
                        <div class="mini-stat-label">è¯·æ·»åŠ éœ€è¦æ¯å¤©å®Œæˆçš„ä»»åŠ¡</div>
                    </div>
                `;
                return;
            }

            const today = new Date().toDateString();
            const completedToday = JSON.parse(localStorage.getItem(`dailyTasksCompleted_${currentUser}_${today}`) || '[]');

            dailyTaskList.innerHTML = userDailyTasks.map(task => `
                <div class="task-item ${completedToday.includes(task.id) ? 'completed' : ''}">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                    </div>
                    <div>
                        <button onclick="toggleDailyTask(${task.id})" class="btn-${completedToday.includes(task.id) ? 'secondary' : 'primary'}">
                            ${completedToday.includes(task.id) ? 'å–æ¶ˆå®Œæˆ' : 'å®Œæˆ'}
                        </button>
                        <button onclick="deleteDailyTask(${task.id})" class="btn-danger">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');

            todayDailyTasks.innerHTML = userDailyTasks.map(task => `
                <div class="mini-stat">
                    <div class="mini-stat-number">${completedToday.includes(task.id) ? 'âœ…' : 'â³'}</div>
                    <div class="mini-stat-label">${task.title}</div>
                </div>
            `).join('');
        }

        function toggleDailyTask(taskId) {
            const today = new Date().toDateString();
            const storageKey = `dailyTasksCompleted_${currentUser}_${today}`;
            const completedToday = JSON.parse(localStorage.getItem(storageKey) || '[]');

            if (completedToday.includes(taskId)) {
                const index = completedToday.indexOf(taskId);
                completedToday.splice(index, 1);
                showNotification('æ¯æ—¥ä»»åŠ¡å·²å–æ¶ˆå®Œæˆ', 'info');
            } else {
                completedToday.push(taskId);
                showNotification('æ¯æ—¥ä»»åŠ¡å·²å®Œæˆï¼', 'success');
            }

            localStorage.setItem(storageKey, JSON.stringify(completedToday));
            loadDailyTasks();
            updateDashboard();
        }

        function deleteDailyTask(taskId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¯æ—¥ä»»åŠ¡å—ï¼Ÿ')) return;

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[currentUser]) return;

            users[currentUser].dailyTasks = users[currentUser].dailyTasks.filter(t => t.id !== taskId);
            localStorage.setItem('users', JSON.stringify(users));
            loadDailyTasks();
            updateDashboard();
            showNotification('æ¯æ—¥ä»»åŠ¡å·²åˆ é™¤', 'info');
        }

        // è®¾ç½®ç®¡ç†
        function loadSettings() {
            const savedSettings = localStorage.getItem('settings');
            if (savedSettings) {
                settings = { ...settings, ...JSON.parse(savedSettings) };
            }
        }

        function saveSettings() {
            settings.workDuration = parseInt(document.getElementById('workDuration').value);
            settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            settings.longBreakInterval = parseInt(document.getElementById('longBreakInterval').value);

            localStorage.setItem('settings', JSON.stringify(settings));
            showNotification('è®¾ç½®å·²ä¿å­˜', 'success');
        }

        function loadSettingsUI() {
            document.getElementById('workDuration').value = settings.workDuration;
            document.getElementById('shortBreakDuration').value = settings.shortBreakDuration;
            document.getElementById('longBreakDuration').value = settings.longBreakDuration;
            document.getElementById('longBreakInterval').value = settings.longBreakInterval;

            document.getElementById('soundToggle').classList.toggle('active', settings.sound);
            document.getElementById('notificationToggle').classList.toggle('active', settings.notification);
        }

        function toggleSetting(settingName) {
            settings[settingName] = !settings[settingName];
            localStorage.setItem('settings', JSON.stringify(settings));
            
            const toggle = document.getElementById(settingName + 'Toggle');
            toggle.classList.toggle('active', settings[settingName]);
            
            showNotification(`${settingName === 'sound' ? 'å£°éŸ³æé†’' : 'æ¡Œé¢é€šçŸ¥'}å·²${settings[settingName] ? 'å¼€å¯' : 'å…³é—­'}`, 'info');
        }

        // æ•°æ®ç®¡ç†
        function exportData() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const currentUserData = users[currentUser];
            
            if (!currentUserData) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
                return;
            }

            const exportData = {
                user: currentUserData,
                settings: settings,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `study-data-${currentUser}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.user && importedData.user.username) {
                        const users = JSON.parse(localStorage.getItem('users') || '{}');
                        users[importedData.user.username] = importedData.user;
                        localStorage.setItem('users', JSON.stringify(users));
                        
                        if (importedData.settings) {
                            settings = { ...settings, ...importedData.settings };
                            localStorage.setItem('settings', JSON.stringify(settings));
                        }
                        
                        showNotification('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
                        updateDashboard();
                        loadTasks();
                        loadDailyTasks();
                        loadSettingsUI();
                    } else {
                        showNotification('å¯¼å…¥æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                    }
                } catch (error) {
                    showNotification('å¯¼å…¥æ–‡ä»¶è§£æå¤±è´¥', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;

            localStorage.removeItem('users');
            localStorage.removeItem('settings');
            localStorage.removeItem('currentUser');
            
            showNotification('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'info');
            location.reload();
        }

        // å­¦ä¹ æ—¶é—´ç®¡ç†
        function addStudyTime(seconds) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[currentUser]) return;

            users[currentUser].stats.totalTime += seconds;
            
            const today = new Date().toDateString();
            if (!users[currentUser].dailyStats[today]) {
                users[currentUser].dailyStats[today] = { pomodoros: 0, tasks: 0, time: 0 };
            }
            users[currentUser].dailyStats[today].time += seconds;

            localStorage.setItem('users', JSON.stringify(users));
            updateDashboard();
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        // ä»ªè¡¨ç›˜æ›´æ–°
        function updateDashboard() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userData = users[currentUser];
            
            if (!userData) return;

            const today = new Date().toDateString();
            const todayStats = userData.dailyStats[today] || { pomodoros: 0, tasks: 0, time: 0 };

            document.getElementById('todayTime').textContent = formatTime(todayStats.time);
            document.getElementById('todayPomodoros').textContent = todayStats.pomodoros;
            document.getElementById('todayTasks').textContent = todayStats.tasks;
            
            document.getElementById('totalTime').textContent = formatTime(userData.stats.totalTime);
            document.getElementById('totalTasks').textContent = userData.stats.totalTasks;
            document.getElementById('totalPomodoros').textContent = userData.stats.totalPomodoros;
            document.getElementById('currentStreak').textContent = userData.stats.currentStreak;
            document.getElementById('bestStreak').textContent = userData.stats.bestStreak;

            updateTodayTaskList();
        }

        function updateTodayTaskList() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const userTasks = users[currentUser]?.tasks || [];
            
            const today = new Date().toDateString();
            const todayTasks = userTasks.filter(task => {
                const taskDate = new Date(task.createdAt).toDateString();
                return taskDate === today || task.dueDate === new Date().toISOString().split('T')[0];
            });

            const todayTaskList = document.getElementById('todayTaskList');
            
            if (todayTasks.length === 0) {
                todayTaskList.innerHTML = `
                    <div class="task-item">
                        <div class="task-content">
                            <div class="task-title">æš‚æ— ä»»åŠ¡</div>
                            <div class="task-description">è¯·æ·»åŠ ä»Šæ—¥çš„å­¦ä¹ ä»»åŠ¡</div>
                        </div>
                    </div>
                `;
                return;
            }

            todayTaskList.innerHTML = todayTasks.slice(0, 5).map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''} priority-${task.priority}">
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                    </div>
                    <div>
                        <button onclick="toggleTask(${task.id})" class="btn-${task.completed ? 'secondary' : 'primary'}">
                            ${task.completed ? 'âœ…' : 'å®Œæˆ'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // é€šçŸ¥åŠŸèƒ½
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #ef5350, #f44336)';
            } else if (type === 'warning') {
                notification.style.background = 'linear-gradient(135deg, #ffb74d, #ffa726)';
            } else if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #4caf50, #66bb6a)';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function showDesktopNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ…</text></svg>'
                });
            }
        }

        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
    </script>
</body>
</html>